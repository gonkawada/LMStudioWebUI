# 実装計画: LM Studio Chat WebUI

## 概要

このプロジェクトは既存の実装を持つため、実装計画はテストの追加、コード品質の向上、ドキュメント化に焦点を当てます。既存のコードベースは単一のHTMLファイル（index.html）で構成されており、すべての機能が実装済みです。

## タスク

- [ ] 1. テスト環境のセットアップ
  - テストフレームワーク（Jest + jsdom または Vitest）のインストールと設定
  - fast-checkライブラリのインストール（プロパティベーステスト用）
  - テストディレクトリ構造の作成
  - _要件: すべての要件のテスト基盤_

- [ ] 2. サーバー接続管理のテスト
  - [ ] 2.1 接続機能のユニットテスト
    - 有効なサーバーURLでの接続成功テスト
    - 無効なサーバーURLでの接続失敗テスト
    - 接続/切断時のUI状態変更テスト
    - _要件: 1.1, 1.2, 1.3, 1.4_
  
  - [ ]* 2.2 接続状態とUI要素の有効化プロパティテスト
    - **プロパティ3: 接続状態とUI要素の有効化**
    - **検証: 要件 1.5**
  
  - [ ]* 2.3 接続失敗時のエラー表示プロパティテスト
    - **プロパティ2: 接続失敗時のエラー表示**
    - **検証: 要件 1.3, 15.1**

- [ ] 3. モデル選択と管理のテスト
  - [ ] 3.1 モデル管理機能のユニットテスト
    - モデル一覧取得とドロップダウン更新テスト
    - モデル切り替え時のアンロード処理テスト
    - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_
  
  - [ ]* 3.2 モデル切り替え時のアンロードプロパティテスト
    - **プロパティ4: モデル切り替え時のアンロード**
    - **検証: 要件 2.3, 2.4**

- [ ] 4. チャットセッション管理のテスト
  - [ ] 4.1 チャット管理機能のユニットテスト
    - 新規チャット作成テスト
    - チャット切り替えテスト
    - チャット削除テスト
    - すべてのチャット削除時の自動作成テスト（エッジケース）
    - _要件: 3.1, 3.2, 3.3, 3.4, 3.5, 3.7_
  
  - [ ]* 4.2 チャット作成時のデフォルト名プロパティテスト
    - **プロパティ5: チャット作成時のデフォルト名**
    - **検証: 要件 3.2**
  
  - [ ]* 4.3 チャット削除後のアクティブチャット管理プロパティテスト
    - **プロパティ6: チャット削除後のアクティブチャット管理**
    - **検証: 要件 3.5, 3.7**
  
  - [ ]* 4.4 チャット名の自動更新プロパティテスト
    - **プロパティ7: チャット名の自動更新**
    - **検証: 要件 3.6**

- [ ] 5. チェックポイント - テストの実行確認
  - すべてのテストが正常に実行されることを確認し、質問があればユーザーに尋ねる

- [ ] 6. メッセージ送受信のテスト
  - [ ] 6.1 メッセージ送信機能のユニットテスト
    - メッセージ送信フローテスト
    - 空メッセージの送信防止テスト
    - メッセージ送信中のUI状態テスト
    - _要件: 4.1, 4.2, 4.5, 4.6, 4.7_
  
  - [ ]* 6.2 空メッセージの送信防止プロパティテスト
    - **プロパティ8: 空メッセージの送信防止**
    - **検証: 要件 4.5**

- [ ] 7. 会話履歴構築のテスト
  - [ ] 7.1 会話履歴機能のユニットテスト
    - システムプロンプト選択テスト（画像あり/なし）
    - メッセージロール割り当てテスト
    - 画像メッセージフォーマットテスト
    - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_
  
  - [ ]* 7.2 会話履歴の構築プロパティテスト
    - **プロパティ9: 会話履歴の構築**
    - **検証: 要件 5.1, 5.4**
  
  - [ ]* 7.3 画像メッセージのシステムプロンプトプロパティテスト
    - **プロパティ10: 画像メッセージのシステムプロンプト**
    - **検証: 要件 5.2**
  
  - [ ]* 7.4 テキストのみのシステムプロンプトプロパティテスト
    - **プロパティ11: テキストのみのシステムプロンプト**
    - **検証: 要件 5.3**
  
  - [ ]* 7.5 画像メッセージのフォーマットプロパティテスト
    - **プロパティ12: 画像メッセージのフォーマット**
    - **検証: 要件 5.5**

- [ ] 8. 画像アップロード機能のテスト
  - [ ] 8.1 画像アップロード機能のユニットテスト
    - ファイル選択とBase64変換テスト
    - プレビュー表示テスト
    - 画像メッセージ作成テスト
    - デフォルトプロンプトテスト
    - _要件: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6_
  
  - [ ]* 8.2 画像なしテキストのデフォルトプロンプトプロパティテスト
    - **プロパティ13: 画像なしテキストのデフォルトプロンプト**
    - **検証: 要件 6.4**

- [ ] 9. Markdownレンダリングのテスト
  - [ ] 9.1 Markdownレンダリング機能のユニットテスト
    - 見出しレンダリングテスト
    - 段落レンダリングテスト
    - 引用ブロックレンダリングテスト
    - インラインコードレンダリングテスト
    - GFM機能テスト（テーブル、タスクリスト）
    - 改行変換テスト
    - _要件: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_
  
  - [ ]* 9.2 Markdownレンダリングプロパティテスト
    - **プロパティ14: Markdownレンダリング**
    - **検証: 要件 7.1**
  
  - [ ]* 9.3 GFMサポートプロパティテスト
    - **プロパティ15: GFMサポート**
    - **検証: 要件 7.6**
  
  - [ ]* 9.4 改行の自動変換プロパティテスト
    - **プロパティ16: 改行の自動変換**
    - **検証: 要件 7.7**

- [ ] 10. チェックポイント - レンダリング機能の確認
  - すべてのレンダリングテストが正常に実行されることを確認し、質問があればユーザーに尋ねる

- [ ] 11. コードブロックのシンタックスハイライトのテスト
  - [ ] 11.1 シンタックスハイライト機能のユニットテスト
    - コードブロックハイライトテスト
    - 言語別ハイライトテスト
    - コピーボタン追加テスト
    - コピー機能とフィードバックテスト
    - _要件: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6_
  
  - [ ]* 11.2 コードブロックのシンタックスハイライトプロパティテスト
    - **プロパティ17: コードブロックのシンタックスハイライト**
    - **検証: 要件 8.1**
  
  - [ ]* 11.3 言語別シンタックスハイライトプロパティテスト
    - **プロパティ18: 言語別シンタックスハイライト**
    - **検証: 要件 8.2**
  
  - [ ]* 11.4 コピーボタンの追加プロパティテスト
    - **プロパティ19: コピーボタンの追加**
    - **検証: 要件 8.4**
  
  - [ ]* 11.5 コピーボタンのフィードバックプロパティテスト
    - **プロパティ20: コピーボタンのフィードバック**
    - **検証: 要件 8.5, 8.6**

- [ ] 12. LaTeX数式レンダリングのテスト
  - [ ] 12.1 LaTeX数式レンダリング機能のユニットテスト
    - インライン数式レンダリングテスト
    - ディスプレイ数式レンダリングテスト
    - エスケープシーケンス処理テスト
    - レンダリング失敗時のエラーハンドリングテスト
    - 特定のHTMLタグ内での処理スキップテスト
    - _要件: 9.1, 9.2, 9.3, 9.4, 9.5, 9.6_
  
  - [ ]* 12.2 LaTeX数式レンダリングプロパティテスト
    - **プロパティ21: LaTeX数式レンダリング**
    - **検証: 要件 9.1**
  
  - [ ]* 12.3 インライン数式構文サポートプロパティテスト
    - **プロパティ22: インライン数式構文サポート**
    - **検証: 要件 9.2**
  
  - [ ]* 12.4 ディスプレイ数式構文サポートプロパティテスト
    - **プロパティ23: ディスプレイ数式構文サポート**
    - **検証: 要件 9.3**

- [ ] 13. ストリーミングレスポンス処理のテスト
  - [ ] 13.1 ストリーミング処理機能のユニットテスト
    - ストリーミングリクエストパラメータテスト
    - チャンク解析テスト
    - "[DONE]"シグナル処理テスト
    - ストリーミング中のエラーハンドリングテスト
    - レンダリング更新テスト
    - _要件: 10.1, 10.2, 10.3, 10.4, 10.5, 10.6, 10.7_
  
  - [ ]* 13.2 ストリーミングリクエストパラメータプロパティテスト
    - **プロパティ24: ストリーミングリクエストパラメータ**
    - **検証: 要件 10.1**
  
  - [ ]* 13.3 ストリーミングチャンクの解析プロパティテスト
    - **プロパティ25: ストリーミングチャンクの解析**
    - **検証: 要件 10.3, 10.4**
  
  - [ ]* 13.4 ストリーミング終了処理プロパティテスト
    - **プロパティ26: ストリーミング終了処理**
    - **検証: 要件 10.5**
  
  - [ ]* 13.5 ストリーミング中のレンダリング更新プロパティテスト
    - **プロパティ27: ストリーミング中のレンダリング更新**
    - **検証: 要件 10.7**

- [ ] 14. チェックポイント - ストリーミング機能の確認
  - すべてのストリーミングテストが正常に実行されることを確認し、質問があればユーザーに尋ねる

- [ ] 15. UI機能のテスト
  - [ ] 15.1 サイドバートグル機能のユニットテスト
    - サイドバー折りたたみ/展開テスト
    - コンテンツ表示/非表示テスト
    - _要件: 11.1, 11.2, 11.3, 11.4_
  
  - [ ]* 15.2 サイドバートグルプロパティテスト
    - **プロパティ28: サイドバートグル**
    - **検証: 要件 11.1, 11.2, 11.3**

- [ ] 16. レスポンシブデザインのテスト
  - [ ] 16.1 レスポンシブ機能のユニットテスト
    - モバイルビューでのサイドバー非表示テスト
    - モバイルビューでのメッセージ幅テスト
    - モバイルビューでのレイアウトテスト
    - タッチフレンドリーなUI要素サイズテスト
    - _要件: 12.1, 12.2, 12.3, 12.4, 12.5_
  
  - [ ]* 16.2 レスポンシブサイドバープロパティテスト
    - **プロパティ29: レスポンシブサイドバー**
    - **検証: 要件 12.1**
  
  - [ ]* 16.3 レスポンシブメッセージ幅プロパティテスト
    - **プロパティ30: レスポンシブメッセージ幅**
    - **検証: 要件 12.2**
  
  - [ ]* 16.4 レスポンシブレイアウトプロパティテスト
    - **プロパティ31: レスポンシブレイアウト**
    - **検証: 要件 12.3**
  
  - [ ]* 16.5 タッチフレンドリーなUI要素プロパティテスト
    - **プロパティ32: タッチフレンドリーなUI要素**
    - **検証: 要件 12.5**

- [ ] 17. UIテーマとアニメーションのテスト
  - [ ] 17.1 UIテーマとアニメーション機能のユニットテスト
    - カラースキームテスト
    - メッセージアニメーションテスト
    - ホバー効果テスト
    - _要件: 13.1, 13.2, 13.3, 13.4, 13.5, 13.6, 13.7, 13.8_
  
  - [ ]* 17.2 メッセージアニメーションプロパティテスト
    - **プロパティ33: メッセージアニメーション**
    - **検証: 要件 13.6**

- [ ] 18. パフォーマンスメトリクスのテスト
  - [ ] 18.1 パフォーマンスメトリクス機能のユニットテスト
    - 開始時刻記録テスト
    - 終了時刻記録と経過時間計算テスト
    - メトリクス表示テスト
    - _要件: 14.1, 14.2, 14.3, 14.4_
  
  - [ ]* 18.2 パフォーマンスメトリクスの計測プロパティテスト
    - **プロパティ34: パフォーマンスメトリクスの計測**
    - **検証: 要件 14.1, 14.2, 14.3**

- [ ] 19. エラーハンドリングのテスト
  - [ ] 19.1 エラーハンドリング機能のユニットテスト
    - 接続エラーハンドリングテスト
    - メッセージ送信エラーハンドリングテスト
    - ストリーミングエラーハンドリングテスト
    - レンダリングエラーハンドリングテスト
    - _要件: 15.1, 15.2, 15.3, 15.4, 15.5, 15.6_
  
  - [ ]* 19.2 エラーメッセージの表示プロパティテスト
    - **プロパティ35: エラーメッセージの表示**
    - **検証: 要件 15.1, 15.2, 15.3, 15.4, 15.5, 15.6**

- [ ] 20. チェックポイント - エラーハンドリングの確認
  - すべてのエラーハンドリングテストが正常に実行されることを確認し、質問があればユーザーに尋ねる

- [ ] 21. データ永続化のテスト
  - [ ] 21.1 データ永続化機能のユニットテスト
    - チャットセッション保存テスト
    - メッセージ保存テスト
    - チャット切り替え時の読み込みテスト
    - 接続メッセージの非保存テスト
    - _要件: 16.1, 16.2, 16.3, 16.5_
  
  - [ ]* 21.2 チャットセッションのメモリ保存プロパティテスト
    - **プロパティ36: チャットセッションのメモリ保存**
    - **検証: 要件 16.1, 16.2, 16.3**
  
  - [ ]* 21.3 接続メッセージの非保存プロパティテスト
    - **プロパティ37: 接続メッセージの非保存**
    - **検証: 要件 16.5**

- [ ] 22. アクセシビリティとユーザビリティのテスト
  - [ ] 22.1 アクセシビリティとユーザビリティ機能のユニットテスト
    - 初期フォーカス設定テスト
    - メッセージ送信後のフォーカス復帰テスト
    - 自動スクロールテスト
    - Enterキーによるメッセージ送信テスト
    - ホバー効果テスト
    - _要件: 17.1, 17.2, 17.3, 17.4, 17.5, 17.6, 17.7_
  
  - [ ]* 22.2 初期フォーカス設定プロパティテスト
    - **プロパティ38: 初期フォーカス設定**
    - **検証: 要件 17.1**
  
  - [ ]* 22.3 メッセージ送信後のフォーカス復帰プロパティテスト
    - **プロパティ39: メッセージ送信後のフォーカス復帰**
    - **検証: 要件 17.2**
  
  - [ ]* 22.4 自動スクロールプロパティテスト
    - **プロパティ40: 自動スクロール**
    - **検証: 要件 17.3**
  
  - [ ]* 22.5 Enterキーによるメッセージ送信プロパティテスト
    - **プロパティ41: Enterキーによるメッセージ送信**
    - **検証: 要件 17.4**
  
  - [ ]* 22.6 ホバー効果プロパティテスト
    - **プロパティ42: ホバー効果**
    - **検証: 要件 17.6**

- [ ] 23. 最終チェックポイント - すべてのテストの実行確認
  - すべてのテストが正常に実行されることを確認し、質問があればユーザーに尋ねる

- [ ] 24. コード品質の向上（オプション）
  - [ ] 24.1 JavaScriptコードの分離
    - HTMLファイルから JavaScript コードを外部ファイルに分離
    - モジュール化とコード整理
  
  - [ ] 24.2 CSSの分離
    - HTMLファイルからCSSを外部ファイルに分離
    - CSS変数の整理と最適化
  
  - [ ] 24.3 ESLintとPrettierの設定
    - コードスタイルの統一
    - 自動フォーマット設定

- [ ] 25. ドキュメント化（オプション）
  - [ ] 25.1 README.mdの拡充
    - インストール手順
    - 使用方法
    - 開発者向けガイド
  
  - [ ] 25.2 API ドキュメントの作成
    - 主要関数のJSDocコメント追加
    - API リファレンスの生成
  
  - [ ] 25.3 ユーザーガイドの作成
    - 機能説明
    - スクリーンショット
    - トラブルシューティング

## 注意事項

- `*`マークが付いたタスクはオプションであり、MVPのために省略可能です
- 各プロパティテストは最低100回の反復を実行する必要があります
- すべてのテストは設計書のプロパティを参照するコメントタグを含める必要があります
- チェックポイントタスクでは、すべてのテストが正常に実行されることを確認してください


- [ ] 26. メッセージコピー機能のテスト
  - [ ] 26.1 メッセージコピー機能のユニットテスト
    - コピーボタンの追加テスト
    - ホバー時のボタン表示テスト
    - コピー機能のテスト
    - コピー成功時のフィードバックテスト
    - コピー失敗時のエラーハンドリングテスト
    - _要件: 18.1, 18.2, 18.3, 18.4, 18.5, 18.6, 18.7, 18.8_
  
  - [ ]* 26.2 メッセージコピーボタンの追加プロパティテスト
    - **プロパティ43: メッセージコピーボタンの追加**
    - **検証: 要件 18.1**
  
  - [ ]* 26.3 メッセージコピーボタンのホバー表示プロパティテスト
    - **プロパティ44: メッセージコピーボタンのホバー表示**
    - **検証: 要件 18.2**
  
  - [ ]* 26.4 メッセージコピー機能プロパティテスト
    - **プロパティ45: メッセージコピー機能**
    - **検証: 要件 18.3**
  
  - [ ]* 26.5 コピー成功時のフィードバックプロパティテスト
    - **プロパティ46: コピー成功時のフィードバック**
    - **検証: 要件 18.4, 18.5**
  
  - [ ]* 26.6 コピーエラーハンドリングプロパティテスト
    - **プロパティ47: コピーエラーハンドリング**
    - **検証: 要件 18.6**

- [ ] 27. サーバー設定永続化機能のテスト
  - [ ] 27.1 サーバー設定永続化機能のユニットテスト
    - ページ読み込み時の設定復元テスト
    - 接続成功時の設定保存テスト
    - モデル選択変更時の設定保存テスト
    - 保存されたモデルの自動選択テスト
    - デフォルトモデルの選択テスト（保存されたモデルが存在しない場合）
    - _要件: 19.1, 19.2, 19.3, 19.4, 19.5, 19.6, 19.7_
  
  - [ ]* 27.2 ページ読み込み時の設定復元プロパティテスト
    - **プロパティ48: ページ読み込み時の設定復元**
    - **検証: 要件 19.1, 19.2**
  
  - [ ]* 27.3 接続成功時の設定保存プロパティテスト
    - **プロパティ49: 接続成功時の設定保存**
    - **検証: 要件 19.3**
  
  - [ ]* 27.4 モデル選択時の設定保存プロパティテスト
    - **プロパティ50: モデル選択時の設定保存**
    - **検証: 要件 19.4**
  
  - [ ]* 27.5 保存されたモデルの自動選択プロパティテスト
    - **プロパティ51: 保存されたモデルの自動選択**
    - **検証: 要件 19.5**
  
  - [ ]* 27.6 デフォルトモデルの選択プロパティテスト
    - **プロパティ52: デフォルトモデルの選択**
    - **検証: 要件 19.6**
